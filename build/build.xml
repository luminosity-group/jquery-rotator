<?xml version="1.0"?>
<project name="rotator" basedir="../src" default="build">

    <property environment="ENV" />

    <property file="../build/project.properties" />

    <target name="build" description="Compress and package up the source">
        <echo message="Building..." />
        <mkdir dir="${dir.intermediate}" />

        <!-- copy source files to intermediate build directory -->
        <copy todir="${dir.intermediate}" includeEmptyDirs="true">
            <fileset dir="." excludes="${file.excludes}">
            </fileset>
        </copy>

        <!-- Repace console.log messages that would break the js in some
             browsers -->
        <replaceregexp match="console.log\(.*\);" replace="" flags="g" byline="false">
            <fileset dir="${dir.intermediate}/${dir.js}" includes="**/*.js" />
        </replaceregexp>

        <!-- minify javascript -->
        <apply executable="java" parallel="false">
            <fileset dir="${dir.js}">
            </fileset>
            <arg line="-jar" />
            <arg path="./${dir.build.tools}/${tool.yuicompressor}" />
            <srcfile />
            <arg line="--line-break"/>
            <arg line="4000"/>
            <arg line="-o"/>
            <mapper type="glob" from="*.js" to="${dir.intermediate}/${dir.js}/*.min.js"/>
            <targetfile/>
        </apply>

        <!-- build tarball -->
        <tar destfile="../build/${name}-${version}.tar.gz" basedir="${dir.intermediate}" compression="gzip" excludes="${file.excludes}" />

        <!-- delete intermediate build directory -->
        <delete dir="${dir.intermediate}" />
    </target>

</project>
